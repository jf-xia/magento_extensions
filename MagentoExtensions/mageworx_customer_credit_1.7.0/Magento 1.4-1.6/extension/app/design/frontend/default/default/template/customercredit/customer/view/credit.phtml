<?php
/**
 * MageWorx
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the MageWorx EULA that is bundled with
 * this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.mageworx.com/LICENSE-1.0.html
 *
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@mageworx.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade the extension
 * to newer versions in the future. If you wish to customize the extension
 * for your needs please refer to http://www.mageworx.com/ for more information
 * or send an email to sales@mageworx.com
 *
 * @category   design_default
 * @package    MageWorx_CustomerCredit
 * @copyright  Copyright (c) 2011 MageWorx (http://www.mageworx.com/)
 * @license    http://www.mageworx.com/LICENSE-1.0.html
 */
 
/**
 * Customer Credit extension
 *
 * @category   design_default
 * @package    MageWorx_CustomerCredit
 * @author     MageWorx Dev Team <dev@mageworx.com>
 */
?>
<div class="box-account box-recent">
    <ol>
        <li>
            <label><?php echo $this->__('Your current credit balance is:')?></label>&nbsp;
            <strong><?php echo Mage::helper('core')->currency($this->getCredit()); ?></strong>
        </li>
        <?php if ($this->isEnabledCodes()):?>
        <li>
            <form id="refill-credit-form" action="<?php echo $this->getFormAction()?>" method="post">
                <fieldset>
                    <ul class="form-list" >
                        <li>
                            <label><?php echo $this->__('Enter Recharge Code to Refill the Balance:')?></label><br />                            
                            <input type="text" class="required-entry input-text" value="<?php echo $this->getCustomerCreditCode()?>" name="customercredit_code"/>
                            <button class="button" type="submit"><span><?php echo $this->__('Submit Code')?></span></button>                            
                        </li>
                    </ul>
                </fieldset>
            </form>
        </li>
        <?php endif;?>
        <?php $creditProduct = $this->helper('customercredit')->getCreditProduct(true); ?>
        <?php if ($creditProduct && $creditProduct->isAvailable()):?>
            <?php $qty = $this->helper('customercredit')->getDefaultQtyCreditUnits(); ?>
            <li>
                <ul class="form-list" >
                    <li>
                        <label>
                            <?php echo $this->__('Qty of Credit Units:')?>&nbsp;
                            <input type="text" class="input-text qty" title="Qty" value="<?php echo $qty; ?>" maxlength="12" id="qty" name="qty" style="width:40px !important;" onchange="changeCreditProductQty(this)"/>
                        </label>
                        &nbsp;
                        <button id="add_to_cart_button" onclick="setLocation('<?php echo $this->getUrl('checkout/cart/add', array('product'=>$creditProduct->getId(), 'qty'=>$qty)) ?>')" class="button btn-cart" title="<?php echo $this->htmlEscape($this->__('Add to Cart')) ?>" type="button"><span><span><?php echo $this->__('Add to Cart') ?></span></span></button>
                    </li>                    
                </ul>
            </li>
            <script type="text/javascript">
            //<![CDATA[
                function changeCreditProductQty(obj) {
                    urlAddToCart = '<?php echo $this->getUrl('checkout/cart/add', array('product'=>$creditProduct->getId())) ?>';        
                    urlAddToCart += 'qty/'+obj.value+'/';        
                    $('add_to_cart_button').writeAttribute('onclick',"setLocation('"+urlAddToCart+"')");
                }
            //]]
            </script>
        <?php endif;?>        
    </ol>
</div>